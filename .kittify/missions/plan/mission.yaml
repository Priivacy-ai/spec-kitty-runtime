# v1 State Machine Definition (plan mission)
mission:
  name: plan
  version: "2.0.0"
  description: "Goal-oriented planning with rollback for iteration"

initial: goals

states:
  - name: goals
    display_name: "Define Goals"
    on_enter: [on_enter_state]
  - name: research
    display_name: "Research & Analysis"
    on_enter: [on_enter_state]
  - name: structure
    display_name: "Structure & Outline"
    on_enter: [on_enter_state]
  - name: draft
    display_name: "Draft Plan"
    on_enter: [on_enter_state]
  - name: review
    display_name: "Review & Approval"
    on_enter: [on_enter_state]
  - name: done
    display_name: "Complete"
    on_enter: [on_enter_state]

transitions:
  - trigger: advance
    source: goals
    dest: research
    conditions:
      - 'artifact_exists("goals.md")'
  - trigger: advance
    source: research
    dest: structure
    conditions:
      - 'artifact_exists("research.md")'
  - trigger: advance
    source: structure
    dest: draft
  - trigger: advance
    source: draft
    dest: review
    conditions:
      - 'artifact_exists("plan.md")'
  - trigger: advance
    source: review
    dest: done
    conditions:
      - 'gate_passed("plan_approved")'
  - trigger: revise
    source: draft
    dest: structure
  - trigger: revise
    source: review
    dest: draft

guards:
  has_goals:
    description: "Goals must be specified"
    check: 'artifact_exists("goals.md")'
  has_research:
    description: "Research must be documented"
    check: 'artifact_exists("research.md")'
  has_plan:
    description: "Plan document must exist"
    check: 'artifact_exists("plan.md")'
  plan_approved:
    description: "Plan must be approved"
    check: 'gate_passed("plan_approved")'

inputs:
  - name: planning_goal
    type: string
    required: true
    description: "The goal or topic to plan"
  - name: project_root
    type: path
    required: true
    description: "Path to the project root"

outputs:
  - name: plan
    type: artifact
    path: "plan.md"
    phase: draft
    description: "The completed plan document"
  - name: research
    type: report
    path: "research.md"
    phase: research
    description: "Research findings supporting the plan"

# v0 compatibility fields
name: "Planning Kitty"
description: "Goal-oriented planning with iterative refinement"
version: "2.0.0"
domain: "other"

workflow:
  phases:
    - name: "goals"
      description: "Define planning goals and scope"
    - name: "research"
      description: "Research and gather information"
    - name: "structure"
      description: "Create outline and structure"
    - name: "draft"
      description: "Write the plan"
    - name: "review"
      description: "Review and approve the plan"

artifacts:
  required: [goals.md, plan.md]
  optional: [research.md, data/]

paths:
  workspace: "docs/"
  deliverables: "docs/"

validation:
  checks: [plan_complete, goals_addressed]
  custom_validators: false

agent_context: |
  You are a planning agent focused on goal-oriented, iterative plan creation.
  Break complex goals into manageable steps. Research before structuring.
  Draft iteratively -- expect revisions.

commands:
  specify:
    prompt: "Define planning goals and success criteria"
  plan:
    prompt: "Research the topic and create a structured plan"
  review:
    prompt: "Review the plan for completeness and feasibility"
